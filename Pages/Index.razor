@page "/"
@using Pipseek.Models;
@using Pipseek.Model;
@using Pipseek.Services;
@using Smart.Blazor;

@inject IDailyTaskRepository dailyTaskRepository
@inject IUserService userService

<div class="row">
	<div class="col-md-6">

        @*Task List*@
        <div class="row d-flex justify-content-center align-items-center">
          <div class="col-md-12 col-xl-10">

            <div class="card">
              <div class="card-header p-3">
                <h5 class="mb-0"><i class="fas fa-tasks me-2"></i>Task List</h5>
                <button @onclick="(async)=>AddTaskAsync()">Add</button>
              </div>
              <div class="card-body" data-mdb-perfect-scrollbar="true" style="position: relative; height: 400px">

                <table class="table mb-0">
                  <thead>
                    <tr>

                      <th scope="col">Task</th>
                      <th scope="col">Priority</th>
                      <th scope="col">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="fw-normal">

                      <td class="align-middle">
                        <span >Call Sam For payments</span >
                      </td>
                      <td class="align-middle">
                        <h6 class="mb-0"><span class="badge bg-danger">High priority</span></h6>
                      </td>
                      <td class="align-middle">
                        <a href="#!" data-mdb-toggle="tooltip" title="Done"><i class="fas fa-check text-success me-3"></i></a>
                        <a href="#!" data-mdb-toggle="tooltip" title="Remove"><i class="fas fa-trash-alt text-danger"></i></a>
                      </td>
                    </tr>
                    <tr class="fw-normal">

                      <td class="align-middle">Make payment to Bluedart</td>
                      <td class="align-middle">
                        <h6 class="mb-0"><span class="badge bg-success">Low priority</span></h6>
                      </td>
                      <td class="align-middle">
                        <a href="#!" data-mdb-toggle="tooltip" title="Done"><i class="fas fa-check text-success me-3"></i></a>
                        <a href="#!" data-mdb-toggle="tooltip" title="Remove"><i class="fas fa-trash-alt text-danger"></i></a>
                      </td>
                    </tr>
                    <tr class="fw-normal">
       
                      <td class="align-middle">Office rent</td>
                      <td class="align-middle">
                        <h6 class="mb-0"><span class="badge bg-warning">Middle priority</span></h6>
                      </td>
                      <td class="align-middle">
                        <a href="#!" data-mdb-toggle="tooltip" title="Done"><i class="fas fa-check text-success me-3"></i></a>
                        <a href="#!" data-mdb-toggle="tooltip" title="Remove"><i class="fas fa-trash-alt text-danger"></i></a>
                      </td>
                    </tr>
                    <tr class="fw-normal">
   
                      <td class="align-middle">Office grocery shopping</td>
                      <td class="align-middle">
                        <h6 class="mb-0"><span class="badge bg-danger">High priority</span></h6>
                      </td>
                      <td class="align-middle">
                        <a href="#!" data-mdb-toggle="tooltip" title="Done"><i class="fas fa-check text-success me-3"></i></a>
                        <a href="#!" data-mdb-toggle="tooltip" title="Remove"><i class="fas fa-trash-alt text-danger"></i></a>
                      </td>
                    </tr>
                    <tr class="fw-normal">
   
                      <td class="align-middle">Ask for Lunch to Clients</td>
                      <td class="align-middle">
                        <h6 class="mb-0"><span class="badge bg-success">Low priority</span></h6>
                      </td>
                      <td class="align-middle">
                        <a href="#!" data-mdb-toggle="tooltip" title="Done"><i class="fas fa-check text-success me-3"></i></a>
                        <a href="#!" data-mdb-toggle="tooltip" title="Remove"><i class="fas fa-trash-alt text-danger"></i></a>
                      </td>
                    </tr>
                    <tr class="fw-normal">
 
                      <td class="border-0 align-middle">Create weekly tasks plan</td>
                      <td class="border-0 align-middle">
                        <h6 class="mb-0"><span class="badge bg-warning">Medium priority</span></h6>
                      </td>
                      <td class="border-0 align-middle">
                        <a href="#!" data-mdb-toggle="tooltip" title="Done"><i class="fas fa-check text-success me-3"></i></a>
                        <a href="#!" data-mdb-toggle="tooltip" title="Remove"><i class="fas fa-trash-alt text-warning"></i></a>
                      </td>
                    </tr>

                    @foreach(var task in this.tasks)
                                {
                    <tr class="fw-normal">
 
                      <td class="border-0 align-middle">@task.Note</td>
                      <td class="border-0 align-middle">
                        <h6 class="mb-0"><span class="badge bg-warning">@task.Note</span></h6>
                      </td>
                      <td class="border-0 align-middle">
                        <a href="#!" data-mdb-toggle="tooltip" title="Done"><i class="fas fa-check text-success me-3"></i>Done</a>
                        <a href="#!" data-mdb-toggle="tooltip" title="Remove"><i class="fas fa-trash-alt text-warning"></i>Remove</a>
                      </td>
                    </tr>
                                }

                  </tbody>
                </table>

              </div>

            </div>


    </div>
  </div>
	</div>
	<div class="col-md-6">
        @*Calendar*@
		<div class="row">
         <Calendar id="calendar" OnChange=@OnChange></Calendar>
         <div class="options">
	    <div class="caption">Events</div>
	    <div class="option" id="log">
	</div>
        </div>
        
        @*Random Pictures*@
		<div class="row">
            <div class="col-md-4">
                <img class="img-thumbnail" src="/img/plants/@plantImage" />
            </div>
            <div class="col-md-8">
                <p>@plantText</p>
            </div>

        </div>
	    </div>
</div>
</div>

@code {

    string plantImage = "";
    string plantText = "";

    IEnumerable<DailyTask> tasks = new List<DailyTask>();

    DateTime date = DateTime.Now.Date;

    Guid userId = default(Guid);

    protected override async Task OnInitializedAsync()
    {
        var plant = Plants.GetRandom();

        plantImage = plant.Key;
        plantText = plant.Value;

        this.userId = this.userService.GetUserId();

        await this.GetTasksAsync();
    }

    private void OnChange(Event eventObj)
    {
        CalendarChangeEventDetail eventDetail = eventObj["Detail"];
        this.date = DateTime.Parse(eventDetail.Value.First()).Date;

        this.GetTasksAsync();
    }

    public async Task AddTaskAsync()
    {
        await this.dailyTaskRepository.CreateTaskAsync(this.userId, this.date.Date, "A TASK THAT TASKS", TimeOfDay.Morning);
        await this.GetTasksAsync();
    }

    public async Task GetTasksAsync()
    {
        this.tasks = await this.dailyTaskRepository.GetTasksAsync(this.userId, this.date);
    }
}